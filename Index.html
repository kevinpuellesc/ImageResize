<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Optimizador Pro: Color, SEO y Lote</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f4f8; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .card { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        
        /* Mejoras para sliders en m칩vil */
        input[type=range] { height: 1.5rem; }
        
        .temp-slider {
            background: linear-gradient(to right, #3b82f6, #f3f4f6, #f97316) !important;
            height: 10px; border-radius: 5px; appearance: none; width: 100%;
        }
        
        .temp-slider::-webkit-slider-thumb {
            appearance: none; width: 24px; height: 24px; background: white;
            border: 2px solid #4b5563; border-radius: 50%; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .center-mark {
            position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
            width: 2px; height: 14px; background: #9ca3af; pointer-events: none; z-index: 1;
        }

        #previewContainer img {
            max-width: 100%; height: auto; border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            background: repeating-conic-gradient(#fff 0% 25%, #f3f4f6 0% 50%) 50% / 20px 20px;
        }

        /* Estilo para scrollbars */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
    </style>
</head>
<body class="p-2 sm:p-6 min-h-screen flex items-center justify-center">

    <div id="app" class="w-full max-w-5xl bg-white rounded-2xl card overflow-hidden flex flex-col lg:flex-row">
        
        <div class="w-full lg:w-5/12 p-5 sm:p-8 bg-white border-b lg:border-b-0 lg:border-r border-gray-100">
            <header class="mb-6">
                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <span>游닞</span> Portafolio Pro
                </h1>
                <p class="text-gray-500 text-sm">Optimizaci칩n de imagen en el cliente.</p>
            </header>

            <div class="space-y-6">
                <div class="relative group">
                    <input type="file" id="imageInput" accept="image/*" multiple class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="handleImageSelection(event)">
                    <div class="p-6 border-2 border-dashed border-gray-300 rounded-xl text-center group-hover:border-emerald-500 group-hover:bg-emerald-50 transition-all">
                        <p class="text-sm font-semibold text-gray-600" id="fileInstruction">Toca o arrastra tus fotos</p>
                        <p class="text-xs text-gray-400 mt-1">Soporta m칰ltiples archivos</p>
                    </div>
                </div>

                <div id="controls" class="hidden space-y-5 animate-in fade-in duration-500">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Formato</label>
                            <select id="outputFormat" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 outline-none" onchange="updateUI()">
                                <option value="image/webp" selected>WebP (Web)</option>
                                <option value="image/jpeg">JPG (Universal)</option>
                                <option value="image/png">PNG (Calidad)</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Largo (px)</label>
                            <input type="number" id="maxDimensionInput" value="1080" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 outline-none" oninput="updateUI()">
                        </div>
                    </div>

                    <div class="space-y-1">
                        <div class="flex justify-between">
                            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Calidad</label>
                            <span id="qualityValue" class="text-xs font-bold text-emerald-600">0.85</span>
                        </div>
                        <input type="range" id="qualitySlider" min="0.1" max="1.0" step="0.05" value="0.85" class="w-full accent-emerald-500" oninput="updateUI()">
                    </div>

                    <div class="pt-4 border-t border-gray-100 space-y-5">
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Saturaci칩n</label>
                                <span id="saturationValue" class="text-xs font-bold text-gray-700">100%</span>
                            </div>
                            <input type="range" id="saturationSlider" min="0" max="200" value="100" class="w-full accent-emerald-500" oninput="updateUI()">
                        </div>

                        <div class="space-y-1">
                            <div class="flex justify-between items-center">
                                <label id="tempLabel" class="text-[10px] font-bold text-gray-400 uppercase tracking-widest transition-colors">Temperatura</label>
                                <span id="tempValue" class="text-xs font-bold text-gray-500">0</span>
                            </div>
                            <div class="relative flex items-center h-8">
                                <div class="center-mark"></div>
                                <input type="range" id="tempSlider" min="-100" max="100" value="0" class="temp-slider relative z-10" oninput="updateUI()">
                            </div>
                        </div>
                    </div>

                    <div class="space-y-1 pt-2">
                        <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">SEO: Nombre de archivo</label>
                        <input type="text" id="filenameTemplate" value="portfolio-{{num}}" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:border-emerald-500" placeholder="proyecto-{{num}}">
                    </div>

                    <button id="processButton" onclick="processAllImages()" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95">
                        Procesar <span id="imageCount">0</span> Im치genes
                    </button>
                </div>
            </div>
        </div>

        <div id="previewArea" class="hidden w-full lg:w-7/12 bg-gray-50 p-5 sm:p-8 flex flex-col">
            <h3 class="text-center text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] mb-4">Vista Previa Real</h3>
            
            <div id="previewContainer" class="flex-grow flex items-center justify-center min-h-[300px]">
                </div>

            <div id="results" class="hidden mt-8 animate-in slide-in-from-bottom duration-500">
                <button onclick="downloadAllAsZip()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-md mb-4 flex items-center justify-center gap-2">
                    游닍 Descargar Lote .ZIP
                </button>
                <div id="resultsList" class="grid grid-cols-1 gap-2 max-h-48 overflow-y-auto custom-scroll pr-2"></div>
            </div>
        </div>
    </div>

    <canvas id="imageCanvas" class="hidden"></canvas>

    <script>
        let selectedFiles = [];
        let processedImagesData = [];
        let currentPreviewImage = null;
        
        const canvas = document.getElementById('imageCanvas');
        const ctx = canvas.getContext('2d');

        function handleImageSelection(event) {
            const files = Array.from(event.target.files).filter(f => f.type.startsWith('image/'));
            if (files.length === 0) return;
            selectedFiles = files;
            document.getElementById('imageCount').textContent = files.length;
            document.getElementById('fileInstruction').textContent = `${files.length} seleccionadas`;

            const reader = new FileReader();
            reader.onload = (e) => {
                currentPreviewImage = new Image();
                currentPreviewImage.onload = () => {
                    document.getElementById('controls').classList.remove('hidden');
                    document.getElementById('previewArea').classList.remove('hidden');
                    updateUI();
                };
                currentPreviewImage.src = e.target.result;
            };
            reader.readAsDataURL(files[0]);
        }

        function updateUI() {
            const tempVal = parseInt(document.getElementById('tempSlider').value);
            const satVal = document.getElementById('saturationSlider').value;
            const qualVal = document.getElementById('qualitySlider').value;

            document.getElementById('qualityValue').textContent = qualVal;
            document.getElementById('saturationValue').textContent = satVal + '%';
            document.getElementById('tempValue').textContent = (tempVal > 0 ? '+' : '') + tempVal;

            const label = document.getElementById('tempLabel');
            if(tempVal === 0) { label.innerText = "Balance Neutro"; label.style.color = "#9ca3af"; }
            else if(tempVal > 0) { label.innerText = "Tono C치lido"; label.style.color = "#b45309"; }
            else { label.innerText = "Tono Fr칤o"; label.style.color = "#1d4ed8"; }

            generatePreview();
        }

        async function generatePreview() {
            if (!currentPreviewImage) return;
            const settings = {
                quality: parseFloat(document.getElementById('qualitySlider').value),
                maxDimension: 800,
                saturation: document.getElementById('saturationSlider').value,
                temperature: parseInt(document.getElementById('tempSlider').value),
                mime: document.getElementById('outputFormat').value
            };
            const res = await applyFilters(currentPreviewImage, settings);
            document.getElementById('previewContainer').innerHTML = `<img src="${URL.createObjectURL(res.blob)}" alt="Preview">`;
        }

        function applyFilters(img, s) {
            return new Promise((resolve) => {
                let { width, height } = img;
                const ratio = Math.min(s.maxDimension / width, s.maxDimension / height, 1);
                width *= ratio; height *= ratio;
                canvas.width = width; canvas.height = height;
                
                ctx.filter = `saturate(${s.saturation}%)`;
                ctx.drawImage(img, 0, 0, width, height);

                if (s.temperature !== 0) {
                    ctx.filter = 'none';
                    ctx.globalCompositeOperation = 'soft-light';
                    const isWarm = s.temperature > 0;
                    const alpha = Math.abs(s.temperature) / 200; 
                    ctx.fillStyle = isWarm ? `rgba(255, 150, 0, ${alpha})` : `rgba(0, 100, 255, ${alpha})`;
                    ctx.fillRect(0, 0, width, height);
                    ctx.globalCompositeOperation = 'source-over';
                }
                canvas.toBlob(blob => resolve({blob, width, height}), s.mime, s.quality);
            });
        }

        async function processAllImages() {
            const resultsList = document.getElementById('resultsList');
            const processBtn = document.getElementById('processButton');
            
            processBtn.disabled = true;
            processBtn.innerText = "Procesando...";
            resultsList.innerHTML = '';
            processedImagesData = [];
            
            const format = document.getElementById('outputFormat').value;
            const ext = format === 'image/jpeg' ? '.jpg' : (format === 'image/png' ? '.png' : '.webp');
            
            const settings = {
                quality: parseFloat(document.getElementById('qualitySlider').value),
                maxDimension: parseInt(document.getElementById('maxDimensionInput').value) || 1080,
                saturation: document.getElementById('saturationSlider').value,
                temperature: parseInt(document.getElementById('tempSlider').value),
                mime: format,
                ext: ext
            };

            for (let i = 0; i < selectedFiles.length; i++) {
                const img = await loadImage(selectedFiles[i]);
                const result = await applyFilters(img, settings);
                const data = { ...result, fileName: selectedFiles[i].name, originalSize: selectedFiles[i].size, extension: settings.ext };
                processedImagesData.push(data);
                displayResult(data);
            }
            
            document.getElementById('results').classList.remove('hidden');
            processBtn.disabled = false;
            processBtn.innerText = `Procesar ${selectedFiles.length} Im치genes`;
        }

        function loadImage(file) {
            return new Promise(res => {
                const r = new FileReader();
                r.onload = e => { const i = new Image(); i.onload = () => res(i); i.src = e.target.result; };
                r.readAsDataURL(file);
            });
        }

        function displayResult(res) {
            const reduction = 100 * (res.originalSize - res.blob.size) / res.originalSize;
            const html = `
                <div class="p-3 border rounded-xl bg-white flex justify-between items-center text-[11px] shadow-sm">
                    <span class="truncate w-1/2 font-semibold text-gray-700">${res.fileName}</span>
                    <span class="text-emerald-600 font-bold">-${reduction.toFixed(0)}%</span>
                    <a href="${URL.createObjectURL(res.blob)}" download="opt_${res.fileName}" class="text-blue-500 font-bold px-3 py-1 bg-blue-50 rounded-lg">Bajar</a>
                </div>`;
            document.getElementById('resultsList').insertAdjacentHTML('beforeend', html);
        }

        async function downloadAllAsZip() {
            const zip = new JSZip();
            const template = document.getElementById('filenameTemplate').value || 'img-{{num}}';
            processedImagesData.forEach((d, i) => {
                const name = template.replace('{{num}}', String(i+1).padStart(3, '0'));
                zip.file(`${name}${d.extension}`, d.blob);
            });
            const content = await zip.generateAsync({type:"blob"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = "imagenes_optimizadas.zip";
            a.click();
        }
    </script>
</body>
</html>
